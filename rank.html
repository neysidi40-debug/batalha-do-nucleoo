<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ranking de MCs</title>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbz4ksxt7doKSzoQBgr0UD06-78vusUbSPkrqYd4K-Y66vi8BGRcBdYBshKFiy6IHHtv6g/exec";

let admin = false;
let mcs = [];

// üîÑ BUSCA DADOS DO BANCO (PLANILHA)
async function carregarMCs() {
  try {
    const res = await fetch(API_URL);
    mcs = await res.json();
    atualizarRanking();
    if (admin) atualizarControle();
  } catch (e) {
    console.error("Erro ao carregar dados", e);
  }
}

// üîÅ ATUALIZA A CADA 2s
setInterval(carregarMCs, 2000);

// üîê LOGIN ADMIN
window.loginAdmin = function () {
  const senha = prompt("Digite a senha de administrador:");
  if (senha === "nucleopass") {
    admin = true;
    document.getElementById("adminArea").style.display = "block";
    atualizarControle();
    alert("Login realizado com sucesso!");
  } else {
    alert("Senha incorreta!");
  }
};

// ‚ûï / ‚ûñ ALTERAR PONTOS
window.alterarPonto = async function (i, valor) {
  mcs[i].pontos += valor;

  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      id: mcs[i].id,
      pontos: mcs[i].pontos
    })
  });
};

// üèÜ RANKING
function atualizarRanking() {
  mcs.sort((a, b) => b.pontos - a.pontos);

  const tabela = document.getElementById("rankTable");
  tabela.innerHTML = `
    <tr>
      <th>Posi√ß√£o</th>
      <th>MC</th>
      <th>Pontos</th>
    </tr>`;

  mcs.forEach((mc, i) => {
    tabela.innerHTML += `
      <tr>
        <td>${i + 1}¬∫</td>
        <td>${mc.nome}</td>
        <td>${mc.pontos}</td>
      </tr>`;
  });

  if (mcs.length > 0) {
    document.getElementById("painel").innerHTML =
      `ü•á <b>L√≠der:</b> ${mcs[0].nome}`;
  }
}

// ‚öôÔ∏è PAINEL ADMIN
function atualizarControle() {
  const tabela = document.getElementById("controleTable");
  tabela.innerHTML = `
    <tr>
      <th>MC</th>
      <th>Pontos</th>
      <th>A√ß√µes</th>
    </tr>`;

  mcs.forEach((mc, i) => {
    tabela.innerHTML += `
      <tr>
        <td>${mc.nome}</td>
        <td>${mc.pontos}</td>
        <td>
          <button class="btn" onclick="alterarPonto(${i},0.5)">+0.5</button>
          <button class="btn" onclick="alterarPonto(${i},-0.5)">‚àí0.5</button>
        </td>
      </tr>`;
  });
}

// üöÄ PRIMEIRA CARGA
carregarMCs();
</script>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: url('fundo.jpg') no-repeat center center fixed;
    background-size: cover;
    color: white;
}
body::before {
    content: "";
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.65);
    backdrop-filter: blur(3px);
    z-index: -1;
}
.container {
    max-width: 450px;
    margin: 40px auto;
    background: rgba(0,0,0,0.65);
    padding: 20px;
    border-radius: 12px;
    border: 2px solid white;
    text-align: center;
}
table {
    width: 100%;
    border-collapse: collapse;
}
table th, table td {
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid white;
}
table th { background: rgba(255,255,255,0.15); }
.btn { padding: 6px 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
.btn-add { background: #44ddff; color:black; }
.btn-edit { background: #ffaa00; }
.btn-del { background: #ff4444; color:white; }
#painel, #painelMC {
    margin-top: 15px;
    padding: 10px;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 8px;
}
#adminArea { display: none; }
</style>
</head>

<body>
<div class="container">
<h1>üèÜ Ranking de MCs</h1>

<div id="painel">Carregando...</div>

<table id="rankTable"></table>

<hr>

<button class="btn-add btn" onclick="loginAdmin()">üîê Login Admin</button>

<div id="adminArea">
<h2>Gerenciar MCs</h2>
<table id="controleTable"></table>
</div>

</div>
</body>
</html>
